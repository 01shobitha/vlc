Index: configure
===================================================================
--- configure	(revision 5813)
+++ configure	(working copy)
@@ -1552,6 +1552,13 @@
 
 echo "Creating config.mak and config.h..."
 
+if test  "$force_prefix" = yes; then
+    libdir="${prefix}/lib"
+    incdir="${prefix}/include/ffmpeg"
+    mandir="${prefix}/man"
+    bindir="${prefix}/bin"
+fi
+
 date >> config.log
 echo "   $0 $FFMPEG_CONFIGURATION" >> config.log
 echo "# Automatically generated by configure - do not modify!" > config.mak
Index: common.mak
===================================================================
--- common.mak	(revision 5813)
+++ common.mak	(working copy)
@@ -21,7 +21,7 @@
 	ln -sf $^ $@
 
 $(SLIBNAME_WITH_MAJOR): $(SHARED_OBJS)
-	$(CC) $(SHFLAGS) $(LDFLAGS) -o $@ $^ $(EXTRALIBS) $(EXTRAOBJS)
+	$(CC) $(LDFLAGS) $(SHFLAGS) -o $@ $^ $(EXTRALIBS) $(EXTRAOBJS)
 ifeq ($(CONFIG_MINGW),yes)
 	-lib /machine:i386 /def:$(@:.dll=.def)
 endif
@@ -60,7 +60,7 @@
 install-libs: $(INSTLIBTARGETS)
 
 install-lib-shared: $(SLIBNAME)
-	install -d "$(libdir)"
+	install -d "$(prefix)$(libdir)"
 ifeq ($(CONFIG_MINGW),yes)
 	install $(INSTALLSTRIP) -m 755 $(SLIBNAME) "$(prefix)"
 else
@@ -73,14 +73,14 @@
 endif
 
 install-lib-static: $(LIB)
-	install -d "$(libdir)"
-	install -m 644 $(LIB) "$(libdir)"
+	install -d "$(prefix)$(libdir)"
+	install -m 644 $(LIB) "$(prefix)$(libdir)"
 
 install-headers:
-	install -d "$(incdir)"
-	install -d "$(libdir)/pkgconfig"
-	install -m 644 $(addprefix "$(SRC_DIR)"/,$(HEADERS)) "$(incdir)"
-	install -m 644 $(BUILD_ROOT)/lib$(NAME).pc "$(libdir)/pkgconfig"
+	install -d "$(prefix)$(incdir)"
+	install -d "$(prefix)$(libdir)/pkgconfig"
+	install -m 644 $(addprefix "$(SRC_DIR)"/,$(HEADERS)) "$(prefix)$(incdir)"
+	install -m 644 $(BUILD_ROOT)/lib$(NAME).pc "$(prefix)$(libdir)/pkgconfig"
 
 uninstall: uninstall-libs uninstall-headers
 
@@ -88,15 +88,15 @@
 ifeq ($(CONFIG_MINGW),yes)
 	-rm -f $(prefix)/$(SLIBNAME)
 else
-	-rm -f $(libdir)/$(SLIBNAME_WITH_MAJOR) \
-	      $(libdir)/$(SLIBNAME)            \
-	      $(libdir)/$(SLIBNAME_WITH_VERSION)
+	-rm -f $(prefix)$(libdir)/$(SLIBNAME_WITH_MAJOR) \
+	      $(prefix)$(libdir)/$(SLIBNAME)            \
+	      $(prefix)$(libdir)/$(SLIBNAME_WITH_VERSION)
 endif
-	-rm -f $(libdir)/$(LIB)
+	-rm -f $(prefix)$(libdir)/$(LIB)
 
 uninstall-headers:
 	rm -f $(addprefix $(incdir)/,$(HEADERS))
-	rm -f $(libdir)/pkgconfig/lib$(NAME).pc
+	rm -f $(prefix)$(libdir)/pkgconfig/lib$(NAME).pc
 
 #
 # include dependency files if they exist
