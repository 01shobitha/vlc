#! /bin/sh

# $Id: woody-buildpackage,v 1.1 2003/02/02 17:18:47 sam Exp $
# Build VLC for a Woody Debian system

if test ! -d debian
then
  echo "No debian/ directory"
  exit 1
fi

# replace (1.2.3-4) with (1.2.3-0woody.4)
sed -e 's/^vlc (\([^)]*\)-\([^-)]*\))/vlc (\1-0woody.\2)/' \
    < debian/changelog >| debian/changelog.woody

# replace liba52-*-dev with a52dec-dev (>=0.7.3)
#         libdv*-dev with libdv-dev
#         libwxgtk2.4-dev with (nil)
sed -e 's/liba52-[^-]*-dev/a52dec-dev (>=0.7.3)/' \
    -e 's/libdv[0-9]*-dev/libdv-dev/' \
    -e 's/, libwx[^,]*//' \
    -e '/Package: wxvlc/,/^ *$/d' \
    < debian/control >| debian/control.woody

# remove wxwindows stuff
sed -e '/# Package: wxvlc/,/^ *$/d' \
    -e '/--enable-wxwindows/d' \
    < debian/rules >| debian/rules.woody
chmod a+x debian/rules.woody

curd="`pwd`"
dirn="`basename \"$curd\"`"
package="`dpkg-parsechangelog -ldebian/changelog.woody | sed -n 's/^Source: //p'`"
version="`dpkg-parsechangelog -ldebian/changelog.woody | sed -n 's/^Version: //p'`"
maintainer="`dpkg-parsechangelog -ldebian/changelog.woody | sed -n 's/^Maintainer: //p'`"
eval `dpkg-architecture -a -t -s -f`
arch="`dpkg-architecture -a -t -qDEB_HOST_ARCH`"
sversion=`echo "$version" | perl -pe 's/^\d+://'`
pv="${package}_${sversion}"
pva="${package}_${sversion}_${arch}"
chg=../"$pva.changes"

dpkg-checkbuilddeps -B debian/control.woody
fakeroot debian/rules.woody clean
cd ..; dpkg-source -b "$dirn"; cd "$dirn"
debian/rules.woody build
fakeroot debian/rules binary
dpkg-genchanges -ldebian/changelog.woody -c debian/control.woody >"$chg"

